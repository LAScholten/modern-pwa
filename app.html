<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hondendatabase PWA - Desktop Edition</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        /* PWA Installatie knop styling */
        #pwaInstallBtn {
            transition: all 0.3s ease;
        }
        
        #pwaInstallBtn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }
        
        /* Responsieve layout voor actieknoppen */
        .navbar-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Standaard layout (desktop): knoppen naast elkaar */
        .action-buttons-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Mobiele layout: knoppen onder elkaar */
        .action-buttons-column {
            display: flex;
            flex-direction: column;
            gap: 5px;
            width: 100%;
        }
        
        /* Disclaimer knop styling */
        #disclaimerBtn {
            background-color: #6c757d;
            border-color: #6c757d;
            color: white;
            font-size: 0.9rem;
            padding: 6px 12px;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        #disclaimerBtn:hover {
            background-color: #5a6268;
            border-color: #545b62;
            transform: translateY(-2px);
        }
        
        /* BEVEILIGINGSSECTIE - LETTERGROOTTE 70% */
        .security-section {
            font-size: 70% !important;
        }
        
        .security-section h5 {
            font-size: 1rem !important;
            margin-bottom: 0.5rem !important;
        }
        
        .security-section p {
            font-size: 0.85rem !important;
            margin-bottom: 0.75rem !important;
        }
        
        .security-section .alert {
            font-size: 0.8rem !important;
            margin-bottom: 0.5rem !important;
            padding: 0.5rem 0.75rem !important;
        }
        
        .security-section .alert strong {
            font-size: 0.85rem !important;
        }
        
        .security-section .alert br {
            margin-bottom: 0.25rem !important;
        }
        
        /* Mobile-specifieke aanpassingen */
        @media (max-width: 768px) {
            .mobile-actions {
                display: flex;
                flex-direction: column;
                gap: 5px;
                margin-top: 5px;
                width: 100%;
            }
            
            .mobile-actions .btn {
                width: 100%;
                justify-content: center;
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            
            /* Verberg de normale layout op mobiel */
            .action-buttons-row {
                display: none !important;
            }
            
            /* Toon mobiele layout */
            .action-buttons-column {
                display: flex !important;
            }
            
            /* Pas navigatie aan voor mobiel */
            .navbar .container-fluid {
                flex-wrap: wrap;
            }
            
            .navbar-actions {
                width: 100%;
                order: 3;
                margin-top: 10px;
            }
            
            /* Maak taal selector compacter op mobiel */
            .btn-group.btn-group-sm {
                margin-right: 0 !important;
            }
            
            /* Disclaimer knop op mobiel */
            #disclaimerBtn {
                width: 100%;
                margin-top: 10px;
            }
        }
        
        /* Desktop: verberg mobiele layout */
        @media (min-width: 769px) {
            .action-buttons-column {
                display: none !important;
            }
            
            .action-buttons-row {
                display: flex !important;
            }
            
            /* Disclaimer knop op desktop */
            #disclaimerBtn {
                display: inline-block;
            }
        }
    </style>
    
    <!-- LOGIN CONTROLE - DIRECT NA HEADER -->
    <script>
        // Eerste controle: check of er user data is
        if (!localStorage.getItem('userEmail')) {
            console.log('‚ùå Geen login data gevonden, ga terug naar login');
            window.location.href = 'index.html';
        } else {
            console.log('‚úÖ Ingelogd als:', localStorage.getItem('userEmail'));
            console.log('üëë Admin status:', localStorage.getItem('isAdmin'));
        }
    </script>
</head>
<body>
    <!-- Supabase client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <!-- MAAK GLOBALE SUPABASE BESCHIKBAAR -->
    <script>
        // Supabase client initialiseren en globaal beschikbaar maken
        window.supabase = window.supabase.createClient(
            'https://owjwkjrktftugjjrcwml.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93andranJrdGZ0dWdqanJjd21sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2MzA4OTAsImV4cCI6MjA4NDIwNjg5MH0.oW6HTAlMBkjUu_4e3kn4iozjn5wK-15h4wCKcaHrtp8'
        );
        
        console.log('‚úÖ Supabase client ge√Ønitialiseerd');
    </script>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-database"></i> 
                <span class="app-text" data-key="appTitle">Hondendatabase PWA - Desktop Edition</span>
            </a>

            
            <div class="navbar-actions">
                <!-- Taal selector in navigatie -->
                <div class="me-3">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-light app-lang-btn active" data-lang="nl" title="Nederlands">
                            üá≥üá±
                        </button>
                        <button class="btn btn-outline-light app-lang-btn" data-lang="en" title="English">
                            üá¨üáß
                        </button>
                        <button class="btn btn-outline-light app-lang-btn" data-lang="de" title="Deutsch">
                            üá©üá™
                        </button>
                    </div>
                </div>
                
                <span class="text-white me-3 d-none d-md-inline">
                    <i class="bi bi-person-circle"></i> 
                    <span id="currentUser">Gebruiker</span>
                </span>
                
                <!-- Desktop layout: knoppen naast elkaar -->
                <div class="action-buttons-row">
                    <!-- Snelkoppeling Knop - ALTIJD ZICHTBAAR -->
                    <button class="btn btn-success btn-sm me-2" id="pwaInstallBtn">
                        <i class="bi bi-link"></i> Maak Snelkoppeling
                    </button>
                    
                    <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                        <i class="bi bi-box-arrow-right"></i> <span class="app-text" data-key="logout">Uitloggen</span>
                    </button>
                </div>
                
                <!-- Mobile layout: knoppen onder elkaar -->
                <div class="action-buttons-column d-none">
                    <!-- Snelkoppeling Knop voor mobiel -->
                    <button class="btn btn-success btn-sm" id="pwaInstallBtnMobile">
                        <i class="bi bi-link"></i> Maak Snelkoppeling
                    </button>
                    
                    <!-- Uitlogknop voor mobiel -->
                    <button class="btn btn-outline-light btn-sm" id="logoutBtnMobile">
                        <i class="bi bi-box-arrow-right"></i> <span class="app-text" data-key="logout">Uitloggen</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="container-fluid mt-3">
        <div class="row">
            <!-- Sidebar Menu -->
            <div class="col-lg-3 col-md-4 mb-3">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="bi bi-menu-button"></i> <span class="app-text" data-key="menu">Menu</span></h5>
                    </div>
                    <div class="list-group list-group-flush">
                        <button class="list-group-item list-group-item-action" id="dataManagementBtn">
                            <i class="bi bi-database-gear"></i> <span class="app-text" data-key="dataManagement">Data Beheer</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="searchBtn">
                            <i class="bi bi-search"></i> <span class="app-text" data-key="searchDog">Hond Zoeken</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="photoGalleryBtn">
                            <i class="bi bi-images"></i> <span class="app-text" data-key="photoGallery">Foto Galerij</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="breedingPlanBtn">
                            <i class="bi bi-calendar-heart"></i> <span class="app-text" data-key="breedingPlan">Fok Planning</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="privateInfoBtn">
                            <i class="bi bi-lock"></i> <span class="app-text" data-key="privateInfo">Priv√© Informatie</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="addDogBtn">
                            <i class="bi bi-plus-circle"></i> <span class="app-text" data-key="newDog">Nieuwe Hond</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="addLitterBtn">
                            <i class="bi bi-motherboard"></i> <span class="app-text" data-key="newLitter">Nieuw Nest</span>
                        </button>
                        <button class="list-group-item list-group-item-action" id="editDogDataBtn">
                            <i class="bi bi-pencil-square"></i> <span class="app-text" data-key="editDogData">Data Hond Bewerken</span>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="card mt-3">
                    <div class="card-header bg-info text-white">
                        <h6 class="mb-0"><i class="bi bi-speedometer2"></i> <span class="app-text" data-key="quickOverview">Snel Overzicht</span></h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-2">
                                <div class="display-6 text-primary" id="quickStatsHonden">0</div>
                                <div class="text-muted small app-text" data-key="dogs">Honden</div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="display-6 text-success" id="quickStatsFotos">0</div>
                                <div class="text-muted small app-text" data-key="photos">Foto's</div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-sm btn-outline-info" id="refreshStatsBtn">
                                <i class="bi bi-arrow-clockwise"></i> <span class="app-text" data-key="refresh">Vernieuwen</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Content Area -->
            <div class="col-lg-9 col-md-8">
                <div class="card">
                    <div class="card-header bg-light">
                        <h4 class="mb-0"><i class="bi bi-house-door"></i> <span class="app-text" data-key="dashboard">Dashboard</span></h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h5><i class="bi bi-check-circle"></i> <span class="app-text" data-key="welcomeTitle">Welkom bij de Hondendatabase PWA - Desktop Edition</span></h5>
                            <p class="app-text" data-key="welcomeText">Kies een optie uit het menu om te beginnen. De interactieve Database online.</p>
                            
                            <!-- DISCLAIMER KNOOP - Wordt nu afgehandeld door disclaimer.js -->
                            <button class="btn btn-secondary" id="disclaimerBtn">
                                <i class="bi bi-info-circle"></i> 
                                <span class="app-text" data-key="disclaimerBtn">Disclaimer/Informatie over COI berekening</span>
                            </button>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5><i class="bi bi-info-circle text-primary"></i> <span class="app-text" data-key="aboutApp">Over deze PWA</span></h5>
                                        <p class="app-text" data-key="appDescription">Deze Progressive Web App heeft verschillende mogelijkheden:</p>
                                        <ul>
                                            <li><strong class="app-text" data-key="feature1">üíæ Opslag:</strong> <span class="app-text" data-key="feature1Desc">Slaat de data op in de online database</span></li>
                                            <li><strong class="app-text" data-key="feature2">üîÑ Easy backup:</strong> <span class="app-text" data-key="feature2Desc">Backups worden weekelijks uitgevoerd door de beheerder</span></li>
                                            <li><strong class="app-text" data-key="feature3">‚ö° Snelle werking:</strong> <span class="app-text" data-key="feature3Desc">Directe toegang tot je gegevens</span></li>
                                            <li><strong class="app-text" data-key="feature4">üîí Veilige opslag:</strong> <span class="app-text" data-key="feature4Desc">Priv√© informatie is alleen te zien door de persoon die deze heeft ingevoerd.</span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card security-section">
                                    <div class="card-body">
                                        <h5><i class="bi bi-shield-check text-success"></i> <span class="app-text" data-key="security">Beveiliging</span></h5>
                                        <p class="app-text" data-key="roleBasedAccess">De app gebruikt rol-gebaseerde toegang:</p>
                                        <div class="alert alert-warning">
                                            <strong class="app-text" data-key="adminRole">Administrator (admin/admin123)</strong><br>
                                            <span class="app-text" data-key="adminRights">Volledige rechten.</span>
                                        </div>
                                        <div class="alert alert-info">
                                            <strong class="app-text" data-key="userPlusRole">Gebruiker+ (user+/user+123)</strong><br>
                                            <span class="app-text" data-key="userPlusRights">Kan honden bekijken, fokplanning maken en eigen honden/nesten toevoegen of bewerken, mits de ouders al in de database staan.</span>
                                        </div>
                                        <div class="alert alert-info">
                                            <strong class="app-text" data-key="userRole">Gebruiker (user/user123)</strong><br>
                                            <span class="app-text" data-key="userRights">Kan honden bekijken, maar niet de eigen fokplanning maken en eigen honden/nesten toevoegen of bewerken.</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modals Container -->
    <div id="modalsContainer"></div>
    
    <!-- Snelkoppeling Instructie Modal -->
    <div class="modal fade" id="installModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="bi bi-link"></i> Snelkoppeling Maken</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="installSteps">
                        <h5>Hoe maak je een snelkoppeling op je apparaat:</h5>
                        
                        <div class="accordion" id="installAccordion">
                            <!-- iPhone/iPad -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#iosSteps">
                                        <i class="bi bi-phone me-2"></i> iPhone/iPad
                                    </button>
                                </h2>
                                <div id="iosSteps" class="accordion-collapse collapse show" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Open Safari en ga naar deze pagina</li>
                                            <li>Tik op het <strong>deel icoon</strong> onderaan (vierkant met pijl omhoog)</li>
                                            <li>Scroll naar beneden en selecteer <strong>"Zet op beginscherm"</strong></li>
                                            <li>Geef de snelkoppeling een naam (bijv. "Hondendatabase")</li>
                                            <li>Tik op <strong>"Toevoegen"</strong> in de rechterbovenhoek</li>
                                            <li>De app verschijnt nu op je beginsscherm!</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Android -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#androidSteps">
                                        <i class="bi bi-phone me-2"></i> Android
                                    </button>
                                </h2>
                                <div id="androidSteps" class="accordion-collapse collapse" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Open Chrome of Firefox en ga naar deze pagina</li>
                                            <li>Tik op het <strong>menu icoon</strong> (drie puntjes) rechtsboven</li>
                                            <li>Selecteer <strong>"Toevoegen aan beginscherm"</strong> of "Installeer app"</li>
                                            <li>Geef de snelkoppeling een naam</li>
                                            <li>Tik op <strong>"Toevoegen"</strong> of "Installeren"</li>
                                            <li>De app verschijnt nu op je beginscherm!</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Windows -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#windowsSteps">
                                        <i class="bi bi-laptop me-2"></i> Windows (Chrome/Edge)
                                    </button>
                                </h2>
                                <div id="windowsSteps" class="accordion-collapse collapse" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <ol>
                                            <li>Open Chrome of Microsoft Edge</li>
                                            <li>Ga naar deze pagina</li>
                                            <li>Klik op het <strong>installatie icoon</strong> rechts in de adresbalk (vierkant met pijl)</li>
                                            <li>Klik op <strong>"Installeren"</strong></li>
                                            <li>De app wordt ge√Ønstalleerd en verschijnt in je startmenu</li>
                                            <li>Je kunt ook een snelkoppeling op je bureaublad maken</li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mac -->
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#macSteps">
                                        <i class="bi bi-laptop me-2"></i> Mac (Safari/Chrome)
                                    </button>
                                </h2>
                                <div id="macSteps" class="accordion-collapse collapse" data-bs-parent="#installAccordion">
                                    <div class="accordion-body">
                                        <h6>Safari:</h6>
                                        <ol>
                                            <li>Ga naar deze pagina in Safari</li>
                                            <li>Klik op "Bestand" in de menubalk</li>
                                            <li>Selecteer <strong>"Toevoegen aan Dock"</strong></li>
                                        </ol>
                                        
                                        <h6>Chrome:</h6>
                                        <ol>
                                            <li>Ga naar deze pagina in Chrome</li>
                                            <li>Klik op het installatie icoon rechts in de adresbalk</li>
                                            <li>Klik op <strong>"Installeren"</strong></li>
                                        </ol>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="bi bi-info-circle"></i> 
                        <strong>Voordeel van een snelkoppeling:</strong> De app werkt als een normale app!
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Sluiten</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Core Modules -->
    <script src="js/auth.js"></script>
    <script src="js/supabase-honden.js"></script>
    
    <!-- Base Module -->
    <script src="js/modules/BaseModule.js"></script>
    
    <!-- COICalculator apart bestand -->
    <script src="js/modules/COICalculator.js"></script>    
    <script src="js/modules/COICalculator2.js"></script>
    
    <!-- Feature Modules -->
    <script src="js/modules/DataManager.js"></script>
    <script src="js/modules/DogManager.js"></script>
    <script src="js/modules/LitterManager.js"></script>
    <script src="js/modules/DogDataManager.js"></script>
    <script src="js/modules/SearchManager.js"></script>
    <script src="js/modules/PhotoManager.js"></script>
    
    <!-- BREEDING MODULES - ALLE DRIE ALTIJD LADEN -->
    <script src="js/modules/BreedingManager.js"></script>
    <script src="js/modules/ReuTeefCombinatie.js"></script>
    <script src="js/modules/ReuTeefStamboom.js"></script>
    <script src="js/modules/ZoekReu.js"></script>
    
    <script src="js/modules/PrivateInfoManager.js"></script>
    
    <!-- StamboomManager -->
    <script src="js/modules/StamboomManager.js"></script>
    
    <!-- Main UI Handler -->
    <script src="js/ui-handler.js"></script>
    
    <!-- Desktop Edition Welkomstscherm -->
    <script src="js/welcome-screen.js"></script>
    
    <!-- Installatie Wizard JavaScript -->
    <script src="js/installatie-wizard.js"></script>
    
    <!-- DISCLAIMER MANAGER -->
    <script src="js/disclaimer-NIEUW.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (window.welcomeScreen) {
                setTimeout(() => window.welcomeScreen.show(), 1000);
            }
        });
    </script>
    
    <!-- App Initialization -->
    <script>
        // Laad taal uit localStorage
        const appLanguage = localStorage.getItem('appLanguage') || 'nl';
        
        // Vertalingen - NU COMPLEET MET ALLE BESCHRIJVINGEN
        const appTranslations = {
            nl: {
                appTitle: "Hondendatabase PWA - Desktop Edition",
                logout: "Uitloggen",
                menu: "Menu",
                dataManagement: "Data Beheer",
                newDog: "Nieuwe Hond",
                newLitter: "Nieuw Nest",
                editDogData: "Data Hond Bewerken",
                searchDog: "Hond Zoeken",
                photoGallery: "Foto Galerij",
                breedingPlan: "Fok Planning",
                privateInfo: "Priv√© Informatie",
                quickOverview: "Snel Overzicht",
                dogs: "Honden",
                photos: "Foto's",
                refresh: "Vernieuwen",
                dashboard: "Dashboard",
                welcomeTitle: "Welkom bij de Hondendatabase PWA - Desktop Edition",
                welcomeText: "Kies een optie uit het menu om te beginnen..",
                aboutApp: "Over deze PWA",
                appDescription: "Deze Progressive Web App heeft verschillende mogelijkheden:",
                feature1: "üíæ Opslag:",
                feature1Desc: "Slaat de data op in de online database",
                feature2: "üîÑ Easy backup:",
                feature2Desc: "Backups worden weekelijks uitgevoerd door de beheerder",
                feature3: "‚ö° Snelle werking:",
                feature3Desc: "Directe toegang tot je gegevens",
                feature4: "üîí Veilige opslag:",
                feature4Desc: "Priv√© informatie is alleen te zien door de persoon die deze heeft ingevoerd.",
                feature5: "Honden toevoegen en beheren",
                feature6: "Data importeren/exporteren",
                security: "Beveiliging",
                roleBasedAccess: "De app gebruikt rol-gebaseerde toegang:",
                adminRole: "Administrator (admin/admin123)",
                adminRights: "Volledige rechten.",
                userPlusRole: "Gebruiker+ (user+/user+123)",
                userPlusRights: "Kan honden bekijken, fokplanning maken en eigen honden/nesten toevoegen of bewerken, mits de ouders al in de database staan.",
                userRole: "Gebruiker (user/user123)",
                userRights: "Kan honden bekijken, maar niet de eigen fokplanning maken en eigen honden/nesten toevoegen of bewerken.",
                disclaimerBtn: "Disclaimer/Informatie over COI berekening",
                installPWA: "Maak Snelkoppeling"
            },
            en: {
                appTitle: "Dog Database PWA - Desktop Edition",
                logout: "Logout",
                menu: "Menu",
                dataManagement: "Data Management",
                newDog: "New Dog",
                newLitter: "New Litter",
                editDogData: "Edit Dog Data",
                searchDog: "Search Dog",
                photoGallery: "Photo Gallery",
                breedingPlan: "Breeding Plan",
                privateInfo: "Private Information",
                quickOverview: "Quick Overview",
                dogs: "Dogs",
                photos: "Photos",
                refresh: "Refresh",
                dashboard: "Dashboard",
                welcomeTitle: "Welcome to the Dog Database PWA - Desktop Edition",
                welcomeText: "Choose an option from the menu to start.",
                aboutApp: "About this PWA",
                appDescription: "This Progressive Web App has several features:",
                feature1: "üíæ Storage:",
                feature1Desc: "Stores data in the online database",
                feature2: "üîÑ Easy backup:",
                feature2Desc: "Backups are performed weekly by the administrator",
                feature3: "‚ö° Fast operation:",
                feature3Desc: "Direct access to your data",
                feature4: "üîí Secure storage:",
                feature4Desc: "Private information is only visible to the person who entered it.",
                feature5: "Add and manage dogs",
                feature6: "Import/Export data",
                security: "Security",
                roleBasedAccess: "The app uses role-based access:",
                adminRole: "Administrator (admin/admin123)",
                adminRights: "Full rights.",
                userPlusRole: "User+ (user+/user+123)",
                userPlusRights: "Can view dogs, create breeding plans, and add/edit own dogs/litters, if provided parents are already in the database.",
                userRole: "User (user/user123)",
                userRights: "Can view dogs, but cannot create own breeding plans and add/edit own dogs/litters.",
                disclaimerBtn: "Disclaimer/Information about COI calculation",
                installPWA: "Create Shortcut"
            },
            de: {
                appTitle: "Hundendatenbank PWA - Desktop Edition",
                logout: "Abmelden",
                menu: "Men√º",
                dataManagement: "Datenverwaltung",
                newDog: "Neuer Hund",
                newLitter: "Neuer Wurf",
                editDogData: "Hundedaten bearbeiten",
                searchDog: "Hund suchen",
                photoGallery: "Foto Galerie",
                breedingPlan: "Zuchtplanung",
                privateInfo: "Private Informationen",
                quickOverview: "Schnell√ºbersicht",
                dogs: "Hunde",
                photos: "Fotos",
                refresh: "Aktualisieren",
                dashboard: "Dashboard",
                welcomeTitle: "Willkommen bei der Hundendatenbank PWA - Desktop Edition",
                welcomeText: "W√§hlen Sie eine option aus dem men√º, um zu beginnen.",
                aboutApp: "√úber diese PWA",
                appDescription: "Diese Progressive Web App hat verschiedene M√∂glichkeiten:",
                feature1: "üíæ Speicher:",
                feature1Desc: "Speichert Daten in der Online-Datenbank",
                feature2: "üîÑ Einfache Sicherung:",
                feature2Desc: "Sicherungen werden w√∂chentlich vom Administrator durchgef√ºhrt",
                feature3: "‚ö° Schnelle Arbeit:",
                feature3Desc: "Direkter Zugriff auf Ihre Daten",
                feature4: "üîí Sichere Speicherung:",
                feature4Desc: "Private Informationen sind nur f√ºr die Person sichtbar, die sie eingegeben hat.",
                feature5: "Hunde hinzuf√ºgen en verwalten",
                feature6: "Daten importieren/exportieren",
                security: "Sicherheit",
                roleBasedAccess: "Die App verwendet rollenbasierte Zugriffe:",
                adminRole: "Administrator (admin/admin123)",
                adminRights: "Volle Rechte.",
                userPlusRole: "Benutzer+ (user+/user+123)",
                userPlusRights: "Kann Hunde ansehen, Zuchtpl√§ne erstellen und eigene Hunde/W√ºrfe hinzuf√ºgen oder bearbeiten, vorausgesetzt die Eltern sind bereits in der Datenbank.",
                userRole: "Benutzer (user/user123)",
                userRights: "Kann Hunde ansehen, aber keine eigenen Zuchtpl√§ne erstellen und keine eigenen Hunde/W√ºrfe hinzuf√ºgen oder bearbeiten.",
                disclaimerBtn: "Disclaimer/Information zur COI Berechnung",
                installPWA: "Verkn√ºpfung erstellen"
            }
        };

        // Pagina tekst vertalen
        function translateAppPage(lang) {
            // Update app teksten
            const elements = document.querySelectorAll('.app-text');
            elements.forEach(element => {
                const key = element.getAttribute('data-key');
                if (appTranslations[lang] && appTranslations[lang][key]) {
                    element.textContent = appTranslations[lang][key];
                }
            });
            
            // Update actieve vlag
            document.querySelectorAll('.app-lang-btn').forEach(btn => {
                if (btn.getAttribute('data-lang') === lang) {
                    btn.classList.add('active');
                    btn.classList.remove('btn-outline-light');
                    btn.classList.add('btn-light');
                } else {
                    btn.classList.remove('active', 'btn-light');
                    btn.classList.add('btn-outline-light');
                }
            });
            
            // Update HTML lang attribuut
            document.documentElement.lang = lang;
            
            // Update pagina titel
            const titles = {
                nl: "Hondendatabase PWA - Desktop Edition",
                en: "Dog Database PWA - Desktop Edition",
                de: "Hundendatenbank PWA - Desktop Edition"
            };
            document.title = titles[lang] || titles.nl;
            
            // Update snelkoppeling knop tekst
            const installButtons = ['pwaInstallBtn', 'pwaInstallBtnMobile'];
            installButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    const text = appTranslations[lang]?.installPWA || appTranslations.nl.installPWA;
                    btn.innerHTML = `<i class="bi bi-link"></i> ${text}`;
                }
            });
        }

        // Event listeners voor vlaggetjes - SIMPELE OPLOSSING: REFRESH DE PAGINA
        document.querySelectorAll('.app-lang-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const lang = this.getAttribute('data-lang');
                localStorage.setItem('appLanguage', lang);
                
                // Simpele oplossing: refresh de pagina
                location.reload();
            });
        });

        // Initialiseer UI Handler
        let ui = null;
        
        // Wacht tot DOM volledig geladen is
        document.addEventListener('DOMContentLoaded', function() {
            try {
                ui = new UIHandler();
                window.appUI = ui;
                window.uiHandler = ui;
                
                console.log('UIHandler succesvol ge√Ønitialiseerd:', ui);
                
                // Controleer of COICalculator beschikbaar is
                if (typeof COICalculator === 'undefined') {
                    console.error('COICalculator is niet beschikbaar! Controleer de laadvolgorde.');
                } else {
                    console.log('COICalculator is beschikbaar:', COICalculator);
                }
                
                // Initialiseer taal
                translateAppPage(appLanguage);
                
                // Toon huidige gebruiker
                const userEmail = localStorage.getItem('userEmail');
                const isAdmin = localStorage.getItem('isAdmin');
                if (userEmail) {
                    document.getElementById('currentUser').textContent = 
                        `${userEmail} (${isAdmin === 'true' ? 'Admin' : 'Gebruiker'})`;
                }
                
                // Setup event listeners voor menu knoppen
                setupMenuEventListeners();
                
                // Setup andere event listeners
                setupOtherEventListeners();
                
                // Setup snelkoppeling functionaliteit
                setupSnelkoppeling();
                
                // Laad initi√´le statistieken
                loadInitialStats();
                
                // Setup responsieve layout
                setupResponsiveLayout();
                
                // Maak de nieuwe modules beschikbaar in window object
                if (typeof ReuTeefCombinatie !== 'undefined') {
                    window.reuTeefCombinatie = ReuTeefCombinatie;
                }
                if (typeof ZoekReu !== 'undefined') {
                    window.zoekReu = ZoekReu;
                }
                
                // **BELANGRIJK: Initialiseer de DisclaimerManager NA de pagina is geladen**
                setTimeout(() => {
                    if (window.disclaimerManager && window.disclaimerManager.init) {
                        window.disclaimerManager.init();
                        console.log('DisclaimerManager ge√Ønitialiseerd');
                    }
                }, 500);
                
            } catch (error) {
                console.error('Fout bij initialiseren UI:', error);
                alert('Fout bij initialiseren applicatie: ' + error.message);
            }
        });
        
        function setupMenuEventListeners() {
            console.log('Setting up menu event listeners');
            
            const menuButtons = {
                'dataManagementBtn': 'data',
                'addDogBtn': 'addDog',
                'addLitterBtn': 'litter',
                'editDogDataBtn': 'editDogData',
                'searchBtn': 'search',
                'photoGalleryBtn': 'photos',
                'breedingPlanBtn': 'breeding',
                'privateInfoBtn': 'private'
            };
            
            for (const [btnId, modalType] of Object.entries(menuButtons)) {
                const btn = document.getElementById(btnId);
                if (btn) {
                    console.log(`Setting up listener for ${btnId}`);
                    btn.addEventListener('click', function() {
                        console.log(`Clicked ${btnId} -> modalType: ${modalType}`);
                        if (ui && ui.showModal) {
                            console.log(`Calling ui.showModal('${modalType}')`);
                            ui.showModal(modalType);
                        } else {
                            console.error('UI handler niet beschikbaar of showModal functie ontbreekt');
                            alert('UI handler niet beschikbaar. Herlaad de pagina.');
                        }
                    });
                } else {
                    console.error(`Button ${btnId} not found`);
                }
            }
        }
        
        function setupOtherEventListeners() {
            console.log('Setting up other event listeners');
            
            // Uitloggen - gebruik nu de auth.js functie
            const logoutButtons = ['logoutBtn', 'logoutBtnMobile'];
            
            logoutButtons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Logout button clicked, calling window.auth.logout()');
                        
                        if (window.auth && window.auth.logout) {
                            window.auth.logout();
                        } else {
                            // Fallback: verwijder localStorage en ga naar login
                            localStorage.removeItem('userEmail');
                            localStorage.removeItem('userId');
                            localStorage.removeItem('isAdmin');
                            window.location.href = 'index.html';
                        }
                    });
                }
            });
            
            // Vernieuw statistieken
            const refreshStatsBtn = document.getElementById('refreshStatsBtn');
            if (refreshStatsBtn) {
                refreshStatsBtn.addEventListener('click', async function() {
                    console.log('Refresh stats button clicked');
                    try {
                        const stats = await window.hondenService.getStatistieken();
                        document.getElementById('quickStatsHonden').textContent = stats.totaalHonden;
                        document.getElementById('quickStatsFotos').textContent = stats.totaalFotos;
                        if (ui && ui.showSuccess) {
                            ui.showSuccess('Statistieken vernieuwd!');
                        }
                    } catch (error) {
                        console.error('Fout bij laden statistieken:', error);
                        if (ui && ui.showError) {
                            ui.showError('Fout bij laden statistieken');
                        }
                    }
                });
            } else {
                console.error('Refresh stats button not found');
            }
        }
        
        // SNELKOPPELING functionaliteit
        function setupSnelkoppeling() {
            // Desktop snelkoppeling knop
            const snelkoppelingBtn = document.getElementById('pwaInstallBtn');
            if (snelkoppelingBtn) {
                snelkoppelingBtn.addEventListener('click', function() {
                    // Toon de snelkoppeling instructies modal
                    const modal = new bootstrap.Modal(document.getElementById('installModal'));
                    modal.show();
                });
            }
            
            // Mobiele snelkoppeling knop
            const snelkoppelingBtnMobile = document.getElementById('pwaInstallBtnMobile');
            if (snelkoppelingBtnMobile) {
                snelkoppelingBtnMobile.addEventListener('click', function() {
                    // Toon de snelkoppeling instructies modal
                    const modal = new bootstrap.Modal(document.getElementById('installModal'));
                    modal.show();
                });
            }
        }
        
        async function loadInitialStats() {
            console.log('Loading initial stats');
            try {
                // Gebruik getStatistieken in plaats van init
                const stats = await window.hondenService.getStatistieken();
                document.getElementById('quickStatsHonden').textContent = stats.totaalHonden;
                document.getElementById('quickStatsFotos').textContent = stats.totaalFotos;
                console.log('Stats loaded:', stats);
            } catch (error) {
                console.error('Fout bij laden statistieken:', error);
            }
        }
        
        // Responsieve layout management
        function setupResponsiveLayout() {
            // Controleer initieel of mobiel
            checkScreenSize();
            
            // Luister naar window resize
            window.addEventListener('resize', checkScreenSize);
        }
        
        function checkScreenSize() {
            const isMobile = window.innerWidth <= 768;
            
            // Zoek de knoppen containers
            const columnLayout = document.querySelector('.action-buttons-column');
            const rowLayout = document.querySelector('.action-buttons-row');
            
            if (isMobile) {
                // Mobiel: toon kolom layout
                if (columnLayout) columnLayout.classList.remove('d-none');
                if (rowLayout) rowLayout.classList.add('d-none');
            } else {
                // Desktop: toon rij layout
                if (columnLayout) columnLayout.classList.add('d-none');
                if (rowLayout) rowLayout.classList.remove('d-none');
            }
        }
        
        // Modal fix
        document.addEventListener('hidden.bs.modal', function() {
            setTimeout(() => {
                const openModals = document.querySelectorAll('.modal.show');
                const backdrops = document.querySelectorAll('.modal-backdrop');
                
                if (openModals.length === 0 && backdrops.length > 0) {
                    backdrops.forEach(backdrop => {
                        backdrop.remove();
                    });
                    
                    document.body.classList.remove('modal-open');
                    document.body.style.overflow = '';
                    document.body.style.paddingRight = '';
                }
            }, 100);
        });
        
        // VERWIJDER de override van showModal in UIHandler.prototype
        // UI Handler aanpassing voor LitterManager
        if (UIHandler && UIHandler.prototype) {
            const originalShowModal = UIHandler.prototype.showModal;
            UIHandler.prototype.showModal = function(modalType) {
                console.log('Modified showModal called with:', modalType);
                
                if (modalType === 'litter') {
                    console.log('Creating litter modal');
                    
                    const litterManager = new LitterManager();
                    
                    if (litterManager.injectDependencies) {
                        litterManager.injectDependencies(this.db, this.auth);
                        console.log('Dependencies injected into LitterManager');
                    }
                    
                    const modalHTML = litterManager.getModalHTML();
                    console.log('Got modal HTML from LitterManager');
                    
                    this.showCustomModal(modalHTML, 'addLitterModal', 'addLitterModalLabel');
                    
                    setTimeout(() => {
                        try {
                            if (litterManager.setupEvents) {
                                const isAdmin = this.auth.isAdmin();
                                if (!isAdmin) {
                                    console.log('User is not admin, showing access denied popup');
                                    return;
                                }
                                litterManager.setupEvents();
                                console.log('LitterManager events setup complete');
                            }
                        } catch (error) {
                            console.error('Error setting up LitterManager events:', error);
                        }
                    }, 500);
                    
                    return;
                }
                
                if (originalShowModal) {
                    originalShowModal.call(this, modalType);
                }
            };
            
            UIHandler.prototype.showCustomModal = function(html, modalId, modalLabelId) {
                console.log('showCustomModal called:', modalId);
                
                const existingModal = document.getElementById(modalId);
                if (existingModal) {
                    existingModal.remove();
                }
                
                const modalsContainer = document.getElementById('modalsContainer');
                if (modalsContainer) {
                    modalsContainer.innerHTML = html;
                    
                    const modalElement = document.getElementById(modalId);
                    if (modalElement) {
                        const modal = new bootstrap.Modal(modalElement);
                        modal.show();
                        
                        this.translateModalContent(modalElement);
                        
                        console.log('Modal shown:', modalId);
                    } else {
                        console.error('Modal element not found after adding to DOM:', modalId);
                    }
                } else {
                    console.error('Modals container not found');
                }
            };
            
            UIHandler.prototype.translateModalContent = function(modalElement) {
                const lang = localStorage.getItem('appLanguage') || 'nl';
                
                const elements = modalElement.querySelectorAll('[data-key]');
                elements.forEach(element => {
                    const key = element.getAttribute('data-key');
                    const translations = appTranslations[lang];
                    if (translations && translations[key]) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.placeholder = translations[key];
                        } else {
                            element.textContent = translations[key];
                        }
                    }
                });
            };
        }
    </script>
    

</body>
</html>